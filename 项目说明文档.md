# 观猹个人猹评获取工具 (Watcha Reviews Exporter) 项目说明文档

## 1. 项目简介

**观猹个人猹评获取工具** 是一个专为 [观猹 (Watcha)](https://watcha.cn) 用户设计的实用工具。旨在帮助用户轻松导出自己在观猹平台上的所有评论（猹评）和讨论帖子，并结合 AI 提示词（Prompt）生成深度洞察报告（如月报、年报）。

本项目采用 **前后端分离** 架构，前端提供简洁的交互界面，后端（通过 Vercel Serverless）处理跨域请求，确保数据获取的稳定性和安全性。

## 2. 核心功能

### 2.1 数据获取与导出
- **猹评导出**：支持获取指定用户的所有"猹评"数据。
- **讨论导出**：支持获取指定用户的所有"讨论"（帖子）数据。
- **智能去重**：自动处理 API 分页可能带来的重复数据。
- **格式化导出**：将获取的数据格式化为易读的 TXT 文本，方便阅读及投喂给 AI。

### 2.2 数据筛选
- **月份筛选**：支持按特定年份和月份筛选数据，便于生成月度汇报。
- **数据预览**：实时显示获取到的数据统计（总条数、字数等）。

### 2.3 AI 辅助分析
- **月报配方**：内置经过优化的 AI 提示词，用户可一键复制。配合导出的 TXT 数据，可使用 ChatGPT/Claude 等 AI 模型生成高质量的《观猹 AI 洞察月报》。
- **[规划中] 年报配方**：即将推出年度回顾专用的 AI 提示词和数据分析功能。

## 3. 技术架构

### 3.1 技术栈
- **前端核心**：HTML5, CSS3, TypeScript (Vanilla)
- **构建工具**：Vite
- **后端/代理**：Vercel Serverless Functions (Node.js)
- **部署平台**：Vercel

### 3.2 关键模块
- **Proxy Service (`api/proxy.ts`)**：作为中间层转发请求，解决浏览器访问观猹 API 时的 CORS（跨域资源共享）问题。
- **API Service (`src/services/api.ts`)**：封装前端 API 调用逻辑，处理分页和错误重试。
- **Review Processor (`src/utils/reviewProcessor.ts`)**：负责数据的清洗、转换、去重和排序。
- **UI Interaction (`src/main.ts`)**：管理页面状态、事件监听和 DOM 更新。

## 4. 部署与环境

### 4.1 本地开发
```bash
npm install       # 安装依赖
npm run dev       # 启动开发服务器 (http://localhost:5173)
```
注意：本地开发时，需确保本地环境能访问外网（观猹 API），或配置好本地代理。

### 4.2 生产环境部署
本项目针对 **Vercel** 进行了优化：
- 自动识别 Vite 项目进行构建。
- `api/` 目录自动部署为 Serverless Functions。
- **注意**：无需手动配置 `vercel.json` 中的 runtime，Vercel 会自动检测。

## 5. 开发历史与更新日志

本项目经历了一系列迭代和修复，主要里程碑如下：

### ✨ 新特性
- **Feature: Posts Export** (2025-12-02)
  - 新增"讨论"数据类型的获取与导出功能。
  - 统一了猹评和讨论的数据处理接口。
- **Feature: Monthly Report Prompt** (2025-12-02)
  - 新增"📝 月报配方"按钮，提供一键复制 AI 提示词功能。
  - 优化提示词结构，包含热力图、认知焦点、盲区诊断等模块。

### 🐛 问题修复
- **Fix: CORS Issue** (2025-12-01)
  - 引入 Vercel Serverless 代理，彻底解决浏览器跨域请求失败问题。
- **Fix: Infinite Loop** (2025-12-01)
  - 修复了在某些 API 错误情况下导致的请求死循环问题。
- **Fix: Duplicate Reviews** (2025-12-01)
  - 修复了 API 分页边缘情况下的数据重复问题，增加了 ID 去重逻辑。
- **Fix: URL Encoding** (2025-12-01)
  - 修复了中文用户名的编码问题，确保能正确解析和请求用户主页。
- **Fix: Deployment** (2025-12-02)
  - 移除了冗余的 `vercel.json` runtime 配置，解决了部署报错问题。

## 6. 未来规划：2025 年度报告（融合版）

基于最新的策划案，项目即将迎来重大更新 —— **观猹 2025 年度报告生成器**。

### 6.1 核心理念
- **Slogan**：「回望365天，看见思维的形状」/「你的2025，在观猹留下了多少思考的痕迹？」
- **目标**：不只是数据汇总，更是认知的年度审计。

### 6.2 规划功能
1.  **全量数据获取**：一键获取 2025 全年数据（自动处理分页和大量数据）。
2.  **可视化报表**：
    - **数据概览**：猹评数、活跃天数、最高产月份。
    - **关注力热力图**：月度关注领域变化。
    - **情绪光谱**：全年情绪基调分析。
3.  **深度内容分析** (AI)：
    - **观点迭代地图**：追踪同一话题的观点演变。
    - **年度预言验证**：年初判断 vs 年末现实。
    - **思维定势诊断**：识别认知盲区。
4.  **分享功能**：生成竖屏海报，方便在观猹社区和社交媒体分享。

## 7. 使用指南

1.  **访问工具**：打开部署好的网站链接。
2.  **输入链接**：在输入框粘贴你的观猹个人主页 URL。
3.  **选择类型**：勾选"猹评"或"讨论"。
4.  **获取数据**：点击"获取数据"，等待进度条完成。
5.  **筛选时间**：(可选) 在下拉框选择特定月份。
6.  **复制配方**：点击"📝 月报配方"复制 AI 提示词。
7.  **导出数据**：点击"导出 TXT"下载数据文件。
8.  **生成报告**：将提示词和数据发送给 ChatGPT/Claude，获取你的深度洞察报告。
