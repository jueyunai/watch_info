# 进展记录

## 2026-01-01 年度报告正式发布

### 任务详情
将首页的年度报告入口对外可见，并优化跳转链接。

### 变更内容
1.  **首页入口 (index.html)**:
    - 取消了年度报告链接的注释，使其对外可见。
    - 将跳转链接从 `/annual.html` 修改为 `/annual`。
2.  **路由配置 (vercel.json)**:
    - 已确认存在 `/annual` 到 `/annual.html` 的重写逻辑。

---


## 2025-12-31 微信端海报字符重叠与遮盖修复

### 任务详情
修复在微信端生成的海报中，左括号 `（` 会盖住后面字符的问题。

### 变更内容
1.  **样式优化 (src/annual.css)**:
    - 在 `poster-mode` 下重置 `letter-spacing` 为 `normal`。
    - 禁用 `font-variant-ligatures` 和 `font-feature-settings: "kern"`，确保 Canvas 渲染时的度量稳定性。
    - 强制段落和列表项左对齐，避免两端对齐导致的间距拉伸。

2.  **渲染优化 (src/annual.ts)**:
    - 在 `renderMarkdown` 函数中增加了标点标准化处理。
    - 将全角括号 `（` `）` 转换为半角括号并添加空格缓冲，彻底规避 Android 微信 WebView 对全角字宽计算不准的问题。
    - 统一并规范化了 Markdown 中的双引号渲染。

### 验证建议
- 在微信环境下重新生成海报，观察括号与其后数字/字符的间距是否恢复正常。

---

## 2025-12-30 LLM 异常提示优化

### 任务详情
当多人并发请求导致 LLM 接口处理不过来或 API 出现异常时，给用户一个友好提示。

### 变更内容
1.  **后端代理 (api/llm.ts)**:
    - 捕获所有厂商调用失败后的最终错误。
    - 返回 HTTP 500 状态码，并包含友好提示 JSON: `{ "error": "让子弹再飞一会，稍后重试哦～", "details": "..." }`。
    - 修复了 `lastError` 属性访问的 TypeScript 警告。

2.  **前端服务 (src/services/llm.ts)**:
    - 在 `chatWithFallback` 函数中，若所有厂商均失败，抛出包含友好提示的错误。

3.  **前端页面 (src/annual.ts)**:
    - 保持现有的错误渲染机制，用户将在 AI 洞察区域看到 "生成失败: 让子弹再飞一会，稍后重试哦～"。
